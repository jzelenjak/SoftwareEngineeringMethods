# Users


## Why

Users microservice is necessary to perform CRUD operations on the users in our application.


## How

The CRUD operations provided by users microservice are the following:
- **register a user** (can be done by anyone; for security reasons everyone is initially registered as a student)
- **query users by user ID, username, role** (can only be done by lecturers and admins) and **by first and last name** (can only be done by admins for security reasons)
- **change the role, the first and last name of a user** (can only be done by admins to prevent the abuse by malicious users)
- **delete a user** (can only be done by admins).

We check the permissions with the help of JWT tokens in every request the user makes (when it is required).


## Unique user ID

In addition, in users microservice _a **unique** user ID_ is generated by the database, which is used by other microservices as the identifier for a user.

Note that username is also an identifier in authentication microservice, thus it does not change even if the first and/or last names change.


## Asynchronous requests to other microservices

Finally, for _register_, _change role_ and _delete_ endpoints, this microservice makes an asynchronous request to the authentication microservice to synchronise the changes.

We have some mechanisms to make those operations atomic (either in both microservices, or in neither) in case of an error response code from the authentication microservice; however, these mechanisms might fail in case of a network failure.


## API

The API documentation for users microservice can be found in `docs/API-document-users.md` file.


## File description

<!Insert here a short description of the purpose of each file in your microservice.>
**Controllers**:
- ```UserController.java```: Takes care of all the users API, following the ```<host><port>/api/users/<request>``` path. Such as _registering, fetching user by username, user ID and role, changing the role, and deleting user_ endpoints.

**Entities**:
- ```User.java```: which is a class to store the data in a User object (database-generated _user ID_, unique _username_, not blank and not null _first and last name_, _role_).
- ```UserRole.java```: which is an enum to store the available user roles: _STUDENT_, _LECTURER_ and _ADMIN_.

**Repositories**:
- ```UserRepository.java```: which is the repository for storing the user data (User entities).

**Service**:
- ```UserService.java```: which is a class that represents a service which communicates with the database containing the user data.

**Config**:
- ```GatewayConfig.java```: which is a class that is used to read the gateway host and port from the properties file.

```UsersMain.java```: the main class of our users microservice.


## Testing

We have properly tested this microservice using unit, integration and manual testing. See `docs/Testing-documentation.md` file for the testing process. 